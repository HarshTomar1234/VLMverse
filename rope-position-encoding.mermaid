graph TD
    A[Query/Key vectors] --> C
    B[Position information] --> C
    C[Apply rotation matrix] --> D[Position-encoded vectors]
    
    E["Rotation Matrix R_θ(m)"] --> F
    F["[cos(mθj)  -sin(mθj)]<br/>[sin(mθj)   cos(mθj)]"] --> G
    G["θj = 10000^(-2j/d)"] --> H
    
    I["Applied to vectors:<br/>q̂m,2j = qm,2j·cos(mθj) - qm,2j+1·sin(mθj)<br/>q̂m,2j+1 = qm,2j·sin(mθj) + qm,2j+1·cos(mθj)"]
    
    J["Complex form:<br/>q̂m = Reℂ(e^(imθ) ⊙ q)"]
    
    K["Properties:<br/>1. Relative position encoding<br/>2. Extrapolation beyond training length<br/>3. Decaying attention with frequency"]
    
    C --> I
    I --> J
    J --> K
    
    style A fill:#f9f9f9,stroke:#333,stroke-width:1px
    style B fill:#f9f9f9,stroke:#333,stroke-width:1px
    style C fill:#e6f7ff,stroke:#333,stroke-width:1px
    style D fill:#f9f9f9,stroke:#333,stroke-width:1px
    style E fill:#f0f0f0,stroke:#333,stroke-width:1px
    style F fill:#f0f0f0,stroke:#333,stroke-width:1px
    style G fill:#f0f0f0,stroke:#333,stroke-width:1px
    style H fill:#f0f0f0,stroke:#333,stroke-width:1px
    style I fill:#e6ffe6,stroke:#333,stroke-width:1px
    style J fill:#e6ffe6,stroke:#333,stroke-width:1px
    style K fill:#e6ffe6,stroke:#333,stroke-width:1px
